<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title></title>
</head>

<script type="text/javascript">
    const JS_CALLER_NAME = 'QuickAndroidJsCallEr';
    const CALLBACK_BASE_NAME = 'Quick_Android_Js_Callback_';
    const CALLBACK_SCAN_CODE_SUCCESS = `${CALLBACK_BASE_NAME}scan_code_success`; // 扫码回调
    const CALLBACK_SCAN_CODE_FAIL = `${CALLBACK_BASE_NAME}scan_code_fail`; // 扫码回调

    function getCaller() {
        return window && window[JS_CALLER_NAME];
    }

    function toast(msg) {
        let caller = getCaller();
        caller && caller.toast(msg)
    }

    function scanCode() {
        return new Promise((resolve, reject) => {
            let caller = getCaller();
            if (!caller)
                return;

            // 接收扫码成功结果回调
            window[CALLBACK_SCAN_CODE_SUCCESS] = (result) => {
                resolve(result);
            };

            // 扫码失败回调
            window[CALLBACK_SCAN_CODE_FAIL] = (errMsg) => {
                reject(errMsg);
            };

            caller && caller.scanCode()
        })
    }

    function doScanCode() {
        console.log("开始扫码")
        scanCode()
            .then(res => {
                toast(res);
                console.log('扫码成功');
            })
            .catch(err => {
                console.log(`扫码失败： `)
                console.error(err)
            })
    }
</script>
<body>
<button type="button" name="button" onclick="doScanCode()">点击扫码</button>
<input type="file" name="" value="">
</body>
</html>
